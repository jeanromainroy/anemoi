<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Anemoi</title>
  <link rel='shortcut icon' type='image/x-icon' href='favicon.ico'/>
  <link rel="stylesheet" href="assets/css/style.css">

  <script type="text/javascript" src="assets/libs/http_requests.js"></script>
  
</head>
<body>
  
   <!-- Top Navigation Bar -->
   <header>
        <div class="container">
        <h1>Anemoi</h1>
        <nav>
                <ul>
                <li><a href="index.html">Mode</a></li>
                <li class="current"><a href="volume.html">VAC VC</a></li>
                <li><a href="pressure.html">VAC PC</a></li>
                </ul>
        </nav>
        </div>
   </header>

  <!-- The Loader -->
  <div id="loader" class="loader" style="position: absolute;left: 45%;top: 45%;"></div> 

  <!-- The Login Form -->
  <section id="input_form" class="input_form">
    <div>

	<p>Air Leakage %</p>
	<p>Flow Graph</p>
	<p>Volume in lung Graph</p>


	<br>
	<br>
	<p>Respiratory Rate (Frequency) (Nbr/Min)</p>
	<input type="text" id="frequency"  name="frequency" maxlength="80" required>

	<p>Inspiratory:Expiratory Time Ratio (%)</p>
        <input type="text" id="inspiration-time"  name="inspiration-time" maxlength="80" required>

	<br>

	<p>Fraction of Inhaled Oxygen (FiO2)</p>
	<input type="text" id="frequency"  name="frequency" maxlength="80" required>

	<br>

	<p>Volume (ml)</p>
	<input type="text" id="volume"  name="volume" maxlength="80" required>

	<p>Peak Pressure (Max Pressure) (cm H2O)</p>
        <input type="text" id="max-pressure"  name="max-pressure" maxlength="80" required>

	<p>PEEP (Min Pressure) (cm H2O)</p>
	<input type="text" id="peep"  name="peep" maxlength="80" required>

	<br>

	<p>Trigger (cm H20)</p>
	<input type="text" id="email"  name="email" maxlength="80" required>

	<br>

	<input type="submit" value="Update" onclick="login()">

    </div> 
  </section>
</body>
<script>

  // Show input form
  document.getElementById("input_form").style.display = 'block';

  // Hide the loader
  document.getElementById("loader").style.display = 'none';

  // remove jwt
  setCookie("jwt", "", 1);

  // Function to login
  function login(){

    // Grab Form Inputs
    var email = document.getElementById("email").value;
    var password = document.getElementById("password").value;

    // Make sure that the inputs are not null
    if(email == null || email == "" || password == null || password == ""){
        alert("Must provide both email and password");
        return;
    }

    // Hide input form
    document.getElementById("input_form").style.display = 'none';

    // Show loader
    document.getElementById("loader").style.display = 'block';

    // Build Query
    var payload = {
        'email': email,
        'password': password
    };

    // Send Request
    request_POST("api/login.php",payload).then(
        function(result) {

          // store email prefix to cookie
          setCookie("email", email, 1);

          // store jwt to cookie
          setCookie("jwt", result.jwt, 1);

          // Send to map after 2.5 seconds
          window.setTimeout(function() {

            // Hide the spinner
            document.getElementById("loader").style.display = 'none';

            // Show input form
            document.getElementById("input_form").style.display = 'block';

            // Send to dashboard
            window.location.href = '/dashboard.html';  

          }, 2500);

        }, 
        function(error){
          alert(error.statusText.message);
        }
    );
  }

</script>
</html>
